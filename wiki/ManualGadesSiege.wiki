#summary Manual introductorio a Gades Siege

En este manual se presentará el modo de uso de Gades Siege, cómo está estructurada la instalación, etcétera.

= Instalación =
La instalación de Gades Siege es muy sencilla y está íntegramente reflejada en el artículo [InstruccionesInstalacion creado a tal efecto].

En este manual vamos a considerar que estamos trabajando con una instalación correcta de Gades Siege. Para ejecutar el juego, dentro de la carpeta del mismo lanzamos el siguiente comando:
{{{
./gsiege.py
}}}

= Opciones del menú principal =
En el menú principal de Gades Siege encontraremos una serie de opciones, que detallaremos con más atención a continuación.

== Partida rápida ==
Este modo nos permite lanzar una partida simple entre dos sistemas expertos. Al abrir este modo, el cuadro de diálogo nos permitirá elegir los equipos que se van a enfrentar, así como diversas opciones adicionales:
  * Podemos elegir el máximo número de turnos del juego con el indicador *Número de turnos*.
  * Si activamos *No guardar la partida*, no se generará ningún fichero de log con el resultado de la misma.
  * Si activamos *Solo los resultados*, nos aparecerá directamente el desenlace final de la partida, sin posibilidad de ver el progreso de la misma.
  * Si activamos *Esconder el valor de las piezas*, el valor de cada pieza aparecerá oculto hasta que sea descubierta por otra pieza.

Una vez pulsemos en el botón *Aplicar*, la partida comenzará con las opciones indicadas.

== Competiciones ==
El modo de competiciones es el modo más usado de Gades Siege. Permite lanzar competiciones variadas entre un gran número de equipos, siguiendo tres posibles formatos:
  * *Liga*: en una liga, todos los equipos juegan contra todos, generándose una clasificación por puntos que determinará los ganadores de la competición.
  * *Copa eliminatoria*: en este caso, los equipos apuntados a la competición son emparejados y enfrentados, de forma aleatoria. Los equipos vencidos son automáticamente eliminados de la competición, y los ganadores pasan a la siguiente ronda. Así, la progresión de partidos se hace en forma de árbol, y en cada ronda siempre hay un número de partidos potencia de dos. Gades Siege está programado de forma que se resuelvan todos las [http://es.wikipedia.org/wiki/Exenci%C3%B3n_%28competiciones_deportivas%29 exenciones] en la primera ronda.
 * *Playoff*: este modo es una mezcla entre los dos anteriores. Primero, se realiza una liga entre todos los participantes. A partir de la clasificación de ésta, la mitad de los jugadores en mejores posiciones jugarán una eliminatoria.

Las opciones en esta ventana son las siguientes:
  * *Ida y vuelta*: esta opción, que solo tiene validez al jugarse una liga, fuerza a que se realicen los partidos entre cada par de equipos dos veces, permutando las posiciones de los equipos.
  * *Solo los resultados*: al igual que en el modo de _partida rápida_, solo muestra los resultados de cada partido, no el transcurso del mismo.
  * *Número de turnos*: igual que en _partida rápida_, permite elegir el número máximo de turnos.

En la pestaña de *Jugadores* podremos elegir los equipos que van a participar en la competición, teniendo la opción de agregar, directamente, todos los equipos instalados en el sistema.

== Jugar contra un sistema experto ==
Este modo es el más interactivo de Gades Siege. Nos permitirá tomar el mando de uno de los equipos del juego y enfrentarnos a un Sistema Experto controlado por la máquina. 

En el apartado *Equipo humano* elegiremos nuestra formación y la posición del equipo. En la sección *Equipo de la máquina* elegiremos nuestro oponente, con la opción de elegirlo al azar. Las opciones de configuración son iguales que en los modos anteriores.

Una vez que lancemos el juego, en nuestros turnos podremos hacer click en la ficha que deseemos mover. Al hacerlo, se nos indicarán con cuadros de color cyan las posibles posiciones a las que mover nuestra ficha. Tal y como le pasara a un sistema experto que nosotros programáramos, no veremos el valor de las fichas enemigas hasta que sean descubiertas por otra ficha. El objetivo del juego es, lógicamente, encontrar y capturar al rey. Una vez que se produzca este evento, la partida terminará.

== Modo laboratorio ==

En este modo podremos poner a pelear a nuestro sistema experto de forma automatizada un gran número de veces. Una vez que elijamos el sistema experto a testear en el apartado *Sistema experto principal*, podremos elegir una serie de opciones:
  * Indicamos el *número de repeticiones* que se realizarán para cada partido.
  * Indicamos también el *número de turnos* máximo para cada encuentro.

Una vez hecho esto, podemos elegir manualmente con qué equipos enfrentar a nuestro sistema, o indicar que se *usen todos los equipos instalados*. Tras esto, simplemente tendremos que aceptar y esperar a que termine el procesamiento.

Al terminar, se nos mostrarán unas estadísticas junto a unas gráficas, con los siguientes datos:
  * Número de encuentros realizados.
  * Partidas ganadas.
  * Partidas perdidas.
  * Partidas empatadas.
  * Número de turnos en los que el sistema gana.
  * Número de turnos en los que el sistema pierde.
  * Turno en el que la pieza de más valor suele perder.

== Partidas antiguas ==
En este modo, es posible revisar partidas previamente jugadas. Al indicar esta opción, tendremos que elegir un fichero de log correcto. Tras ello, aparecerá el reproductor de partidas (el mismo que se utiliza en los otros modos), que nos permitirá reproducir el encuentro.

== Configuración ==
Las opciones de configuración que podemos modificar en esta sección son las siguientes:
  * Ruta al directorio de logs de partidas previas.
  * Ruta al directorio de sistemas expertos. Para que sea un directorio correcto, debe contener dos subdirectorios: *rules* y *formations*. Posteriormente se explicará el sentido de estas carpetas.
  * Opción de activar o desactivar la música en el tablero.
  * Ritmo de avance de las fichas en el modo de avance automático.

== Acerca de ==
En este panel encontrará los créditos del juego, así como información adicional.

= Estructura de ficheros de Gades Siege =
Gades Siege se estructura en la siguiente jerarquía de directorios:
  * *data* : incluye todos los ficheros de recursos,
    * *fonts* : tipografías.
    * *games* : logs de juegos y competiciones anteriores.
    * *glade* : ficheros que definen las interfaces de usuario.
    * *images* : imágenes y gráficos.
    * *music* : música del juego.
    * *teams* : <font color="#ff0000">*importante*</font>, aquí es donde se guardan los ficheros de los equipos. Posteriormente explicaremos con más detalle cómo incluir tus equipos en Gades Siege. Consta de dos subdirectorios:
      * *formations* : aquí se encuentran las formaciones de los equipos, esto es, cómo van colocadas las fichas inicialmente.
      * *rules* : aquí se encuentran las reglas del sistema experto que controla tu equipo.
  * *doc* : Documentación varia, irrelevante.
  * *guadaborad* : ficheros Python con el módulo guadaboard, que se encarga de representar en pantalla las partidas.
  * *libguadalete* : ficheros Python con el módulo del motor principal. Es el que se encargar de procesar los ficheros Clips y generar los resultados de las partidas.
  * *po* : ficheros de traducción.
  * *resistencia* : ficheros Python con el módulo principal del programa, que controla el funcionamiento en general, las interfaces gráficas de usuario, opciones de configuración, etcétera.

== Ficheros de los equipos ==
Como se ha comentado previamente, en el directorio *teams* dentro de *data* encontraremos las carpetas donde guardar los ficheros de nuestro sistema experto. Éste se compone de dos partes.

=== Fichero de formación ===
Los ficheros de formación indican la posición inicial de nuestro sistema experto en el tablero. En anteriores versiones se utilizaba un fichero Clips para expresar estas posiciones, pero posteriormente decidimos utilizar una representación más sencilla.

El fichero de formación debe contenerse en la carpeta *formations* del directorio *teams*, y su nombre debe seguir la estructura *equipoNombre.form*, donde _Nombre_ será el identificador de tu equipo. El contenido de un fichero de formación es muy sencillo de entender:

{{{
6:5:5:4:4:3:3:2
2:2:2:2:2:2:2:1
}}}

Como se ve a simple vista, el fichero consta de dos líneas de números separados entre sí por dos puntos. Estas dos líneas representan las dos filas en las que las fichas podrán colocarse inicialmente en el tablero. En la formación de ejemplo, el rey (número 1) está en la esquina inferior derecha, de forma que tiene bastante protección, es una formación habitual.

=== Fichero de reglas ===
Los ficheros de reglas definen las condiciones que el sistema experto evaluará en cada momento para decidir qué acción tomar. Estos ficheros se encuentran en la carpeta *rules* del directorio *teams*, y la nomenclatura a seguir será *reglasNombre.clp*, siendo _Nombre_, de nuevo, el mismo identificador que en el fichero de formación.

Los ficheros de reglas son ficheros de Clips propiamente, por eso tienen la extensión .clp, y siguen la sintaxis de Clips. En ellos listaremos, una detrás de otra, las reglas de nuestro sistema, por ejemplo:
{{{
(defrule EQUIPO-A::atacar1
  (declare (salience 30))
  (ficha (equipo "A") (num ?n1) (pos-x ?x1)
         (pos-y ?y1) (puntos ?p1))
  (ficha (equipo "B") (num ?n2) (pos-x ?x2)
         (pos-y ?y2) (puntos ?p2) (descubierta 1))
  (test (and (> ?p1 ?p2) (= ?y1 ?y2) (> ?x1 ?x2)))
  (tiempo ?t)
    =>
  (assert (mueve (num ?n1) (mov 2) (tiempo ?t)))
)
}}}

Explicaremos la regla línea a línea:

{{{(defrule EQUIPO-A::atacar1}}} Cabecera de la regla de nombre `atacar1`, dentro del módulo `EQUIPO-A`.

{{{(declare (salience 30))}}} Indicamos la prioridad de la regla respecto al resto.

{{{(ficha (equipo "A") (num ?n1) (pos-x ?x1) (pos-y ?y1) (puntos ?p1))}}} Buscamos una ficha de nuestro equipo y guardamos sus datos en las variables indicadas, para poder hacer luego comprobaciones.

{{{(ficha (equipo "B") (num ?n2) (pos-x ?x2) (pos-y ?y2) (puntos ?p2) (descubierta 1))}}} Buscamos una ficha del equipo contrario, con la condición de que esté descubierta.

{{{(test (and (> ?p1 ?p2) (= ?y1 ?y2) (> ?x1 ?x2)))}}} En este bloque de comprobación, se verifica que nuestra ficha tenga mayor valor que la ficha adversaria, que ambas se encuentren en la misma columna y que nuestra ficha esté más a la derecha que la ficha contraria.

{{{(tiempo ?t)}}} Guardamos en la variable `t` el turno actual.

Si todas estas condiciones se cumplen, se ejecuta el bloque de acciones.

{{{(assert (mueve (num ?n1) (mov 2) (tiempo ?t)))}}} Movemos nuestra ficha en dirección a la ficha adversaria.